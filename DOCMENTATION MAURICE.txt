
Config :
 - express-image : http://172.17.0.3:3333/
 		- /api/students : nom aléatoire

 - static-image : http://172.17.0.2:80/
	  - / : contenu static bootstrap




BUILD  : dans le dossier avec la Dockerfile (le res/apache-php = nom qu'on veut donner)
   docker build -t res/apache-php .

RUN
	docker run -d --name apache_static res/apache-php
   docker run -d -p 8080:80 --name apache_rp res/apache-rp
   docker run -d --name apache_dynamic res/express-students


KILL (exited) depuis bash : 
   docker rm -v $(docker ps -a -q -f status=exited)


INSPECT 
   docker inspect apache_dynamic | grep -i "ipad"




//Pour ce connecter au docker 192.168.99.100

//Avec powershell ou cmder:
docker exec -it -i <nom du container> /bin/bash

//Dossier de config Apache
cd /etc/apache2/sites-available/...


//Changé dans Dockerfile le fait de copier les fichier locaux dans le repertoire apache sur la VM

COPY content/ /var/www/html/


//Rebuild le nouveau build (dans le bon dossier ou ya le Dockerfile)

docker build -t res/apache-php .


//Tué le container qui tournais
docker kill <container>

//Run le container

docker run -p 8080:80 res/apache-php

//Normalement si on va sur 192.168.99.100:9090 on arrive sur index.html qui a le contenu de ce qu'on a copié


//Rajouter dans le dockerfile la commande
apt-get update
apt-get nano

//Partie 2

//Lancé une commande au démmarage de docker
CMD ["node", "/opt/app/index.js"]

//ATTENTION : Changé la version de node de 4.0 à 6.0 sinon ça marchait pas
// dans le fichier Dockerfile
//( SyntaxError: Block-scoped declarations (let, const, function, class) not yet supported outside strict mode)

//Pour aller dans la "boite" Docker et acceder à la vm docker
docker-machine ssh


//Modifié le fichier de conf sur la vm apache2 reverse-proxy
/etc/apache2/sites-available/001-reverse-proxy.conf
//Ecrit avec nano
<VirtualHost *:80>
        ServerName demo.res.ch

        ErrorLog ${APACHE_LOG_DIR}/error.log
        CustomLog ${APACHE_LOG_DIR}/access.log combined

        ProxyPass "/api/students/" "http://172.17.0.3:3333/"
        ProxyPassReverse "/api/students/" "http://172.17.0.3:3333/"

        ProxyPass "/" "http://172.17.0.2:80/"
        ProxyPassReverse "/" "http://172.17.0.2:80/"
</VirtualHost>


//Enabled mod : proxy , proxy_http

/etc/apache2/> a2enmod proxy
/etc/apache2/> a2enmod proxy_http
/etc/apache2/> service apache2 reload


//Pour "automatiser ça" :
cf le dockerfile de reverse-proxy et le dossier conf/

// -----------------  Partie 3 -------------------------

//Pour changer le DNS local :
 - modifier c:\windows\system32\drivers\etc\hosts en mode admin
  -> 192.168.99.100 demo.res.ch
